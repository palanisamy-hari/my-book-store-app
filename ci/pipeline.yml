resources:
  - name: source-code
    type: git
    icon: git
    check_every: 2m
    source:
      uri: "https://github.com/palanisamy-hari/my-book-store-app.git"
      branch: "main"
      username: ((git-user-name))
      password: ((git-password))


jobs:

  - name: deploy-app
    serial: true
    plan:
      - get: source-code
        trigger: true
      - task: deploy-app-heroku
        params:
          HEROKU_EMAIL: ((heroku-email))
          HEROKU_TOKEN: ((heroku-token))
        config:
          platform: linux

          image_resource:
            type: docker-image
            source: { repository: concourse/bosh-cli }

          inputs:
            - name: source-code

          run:
            path: sh
            dir: source-code
            args:
              - -exc
              - |
                cat > /root/.netrc <<EOF
                machine git.heroku.com
                  login $HEROKU_EMAIL
                  password $HEROKU_TOKEN
                EOF
                git push   https://git.heroku.com/simple-book-store-app.git main:refs/heads/main

